# MongoDB Connection URI
MONGODB_URI=mongodb://localhost:27017/k8s-resources

# Session Secret (required for Keystone session authentication)
# Generate a secure random string: openssl rand -hex 32
SESSION_SECRET=your-session-secret-here-change-this-in-production

# API Keys for API authentication (comma-separated)
# Generate secure keys: openssl rand -hex 32
# Leave empty to disable API key authentication (not recommended for production)
VALID_API_KEYS=

# API Port (optional, defaults to Keystone's port)
# API_PORT=3001

# =============================================================================
# Retry Configuration
# =============================================================================

# Maximum number of retry attempts for failed operations
# Default: 5
RETRY_MAX_ATTEMPTS=5

# Initial retry delay in milliseconds (before exponential backoff)
# Default: 1000 (1 second)
RETRY_INITIAL_DELAY_MS=1000

# Maximum retry delay in milliseconds
# Default: 30000 (30 seconds)
RETRY_MAX_DELAY_MS=30000

# Exponential backoff multiplier (each retry delays by this much more)
# Default: 2.0 (doubles each time)
RETRY_BACKOFF_MULTIPLIER=2.0

# =============================================================================
# Timeout Configuration
# =============================================================================

# MongoDB connection timeout in milliseconds
# Default: 30000 (30 seconds)
MONGODB_TIMEOUT_MS=30000

# MongoDB socket timeout in milliseconds
# Default: 45000 (45 seconds)
MONGODB_SOCKET_TIMEOUT_MS=45000

# MongoDB server selection timeout in milliseconds
# Default: 30000 (30 seconds)
MONGODB_SERVER_SELECTION_TIMEOUT_MS=30000

# Kubernetes API request timeout in milliseconds
# Default: 30000 (30 seconds)
K8S_REQUEST_TIMEOUT_MS=30000

# Kubernetes watch connection timeout in milliseconds
# Default: 60000 (60 seconds)
K8S_WATCH_TIMEOUT_MS=60000

# =============================================================================
# MongoDB Connection Pool Configuration
# =============================================================================

# Minimum number of connections in the pool
# Default: 2
MONGO_POOL_MIN=2

# Maximum number of connections in the pool
# Default: 10
MONGO_POOL_MAX=10

# Maximum idle time for a connection in milliseconds
# Default: 60000 (60 seconds)
MONGO_POOL_MAX_IDLE_TIME_MS=60000

# Maximum time to wait for a connection from the pool in milliseconds
# Default: 30000 (30 seconds)
MONGO_POOL_WAIT_QUEUE_TIMEOUT_MS=30000

# =============================================================================
# Bulk Write Configuration
# =============================================================================

# Number of documents per bulk write batch (prevents EPIPE errors)
# Default: 100
# Lower this if you experience EPIPE or timeout errors during sync
BULK_WRITE_BATCH_SIZE=100

# Maximum number of concurrent bulk write operations
# Default: 3
BULK_WRITE_MAX_CONCURRENT=3

# Delay between batches in milliseconds
# Default: 100 (0.1 seconds)
# Increase this if MongoDB is overwhelmed during sync
BULK_WRITE_BATCH_DELAY_MS=100

# =============================================================================
# Feature Flags
# =============================================================================

# Enable automatic reconnection for K8s watches
# Default: true
# Set to false to disable automatic reconnection
ENABLE_K8S_WATCH_RECONNECT=true

# Enable automatic reconnection for MongoDB
# Default: true
# Set to false to disable automatic reconnection
ENABLE_MONGO_RECONNECT=true

# Enable chunked bulk writes (prevents EPIPE errors on large datasets)
# Default: true
# Set to false to use legacy single bulk write (not recommended for large datasets)
ENABLE_CHUNKED_BULK_WRITE=true

# =============================================================================
# Hybrid Sync Configuration
# =============================================================================

# Sync strategy on startup
# Default: auto
# Options:
#   - auto: Sync only if data is missing, stale, or failed (recommended)
#   - always: Always perform full sync on startup (slower startup, maximum reliability)
#   - never: Skip sync on startup (fastest startup, risk of stale data)
SYNC_ON_STARTUP=auto

# Automatically trigger full sync when informer fails
# Default: true
# Set to false to disable automatic recovery (may require manual intervention)
AUTO_SYNC_ON_INFORMER_FAILURE=true

# Periodic sync interval in hours
# Default: 0 (disabled)
# Set to > 0 to enable periodic full sync (e.g., 24 for daily sync)
# Useful for catching missed informer events or data drift
PERIODIC_SYNC_INTERVAL_HOURS=0

# Data staleness threshold in seconds
# Default: 86400 (24 hours)
# Data older than this will trigger a full sync on startup (when SYNC_ON_STARTUP=auto)
# Lower this value for more frequent syncs, higher for less frequent syncs
DATA_STALE_THRESHOLD_SECONDS=86400
